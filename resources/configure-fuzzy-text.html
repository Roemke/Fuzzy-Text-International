<!DOCTYPE html>
<head>

	<!-- Basic Page Needs
  ================================================== -->
	<meta charset="utf-8">
	<title>Configure Fuzzy Text</title>
	<meta name="description" content="configuration page for Fuzzy Text International
  S & T version , a Pebble watchface">

	<!-- Mobile Specific Metas
  ================================================== -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- CSS hmmm bootstrap is not really small - necesssary for simple
	configuration ?
  ================================================== -->
  <!-- check without 
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
  -->

</head>
<body>

	<!-- Primary Page Layout
	================================================== -->

	<div class="container">
		<header>
			<h1>Configure Fuzzy Text Int'l</h1>
		</header>
		
		<div id="update-available" class="hidden bg-danger" style="padding:0.75em">
			<p>There is a new version of Fuzzy Text International S &amp; T
			available - some settings will not work until you update to
			the new version. <a href="CHANGES.html">See
			details</a></p>
		</div>

		<div id="up-to-date" class="hidden bg-info" style="padding:0.75em">
			<p>Your version of Fuzzy Text International is up-to-date.
			<a href="CHANGES.html">See changes</a></p>
		</div>

		<form id="config" role="form" class="input-lg">

			<fieldset>
				<legend>Colors:</legend>
				<div class="checkbox">
					<label>
						<input type="checkbox" name="invert" value="on" />
						invert colors
					</label>
				</div>
			</fieldset>

			<fieldset>
				<legend>Text align:</legend>
				<div class="radio-inline">
					<label>
						<input type="radio" name="align" value="left" />
						left
					</label>
				</div>
				<div class="radio-inline">
					<label>
						<input type="radio" name="align" value="center" checked />
						center
					</label>
				</div>
				<div class="radio-inline">
					<label>
						<input type="radio" name="align" value="right" />
						right
					</label>
				</div>
			</fieldset>

			<fieldset>
				<legend>Language:</legend>
				<div class="radio">
					<label>
						<input type="radio" name="lang" value="ca" />
						Català
					</label>
				</div>

				<div class="radio">
					<label>
						<input type="radio" name="lang" value="de" />
						Deutsch
					</label>
				</div>

				<div class="radio">
					<label>
						<input type="radio" name="lang" value="en_GB" />
						English (Great Britain)
					</label>
				</div>

				<div class="radio">
					<label>
						<input type="radio" name="lang" value="en_US" checked />
						English (United States)
					</label>
				</div>

				<div class="radio">
					<label>
						<input type="radio" name="lang" value="es" />
						Español
					</label>
				</div>

				<div class="radio">
					<label>
						<input type="radio" name="lang" value="fr" />
						Français
					</label>
				</div>

				<div class="radio">
					<label>
						<input type="radio" name="lang" value="no" />
						Norsk
					</label>
				</div>

				<div class="radio">
					<label>
						<input type="radio" name="lang" value="sv" />
						Svenska
					</label>
				</div>
			</fieldset>
			<fieldset>
				<legend>Time options:</legend>
				<div class="checkbox">
					<label>
						<input type="checkbox" name="delta" value="off" />
						show delta to exact time
					</label>
					If switched to on there will be added a text-layer which shows
					the difference from the fuzzy time to the exact time: exact -
					fuzzy in minutes. Layout must be
					left or right to show the delta. Position is in next-to-last line.  
				</div>				
			</fieldset>
			<fieldset>
				<legend>Technical options:</legend>
				<div class="checkbox">
					<label>
						<input type="checkbox" name="battery" value="off" />
						show line which indicates battery status
					</label>
				</div>				
			</fieldset>
				              
			<fieldset>
				<a href="pebblejs://close" class="btn btn-lg btn-default" role="button">Cancel</a>
				<button type="button" class="btn btn-lg btn-primary" id="b-submit">Save</button>
			</fieldset>
		</form>

	</div><!-- container -->

<!-- End Document
================================================== -->
  <!-- change it to own hosted jquery script -->
	<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
	<script>
		var LATEST = "1.3";

		function saveOptions() {
			var params = {}; //read content of #config as array 
			$('#config').serializeArray().forEach(function(pair) {
				params[pair.name] = pair.value;
			});

      //#config array to options object
			var options = {
				invert:		params.invert === 'on',
				text_align:	params.align || 'center',
				lang:		params.lang,
				delta:  params.delta === 'on'
			}
			return options;
		}

    //first called 
		function applyOptions() {
			var $form	= $('#config');
			var opts	= JSON.parse(getParam('options')); 
			//options coming from caller of this page - stored on phone I think,
			//yes, call is coming from pebble-js-app
			if (opts && opts.invert) {
				$form.find('[name="invert"]').prop('checked', true);
			}
			if (opts && opts.text_align) {
				$form.find('[name="align"]').filter(function(i, btn) {
					return btn.value === opts.text_align;
				}).prop('checked', true);
			}
			if (opts && opts.lang) {
				$form.find('[name="lang"]').filter(function(i, btn) {
					return btn.value === opts.lang;
				}).prop('checked', true);
			}
			if (opts && opts.delta) {
				$form.find('[name="delta"]').filter(function(i, btn) {
					return btn.value === opts.delta;
				}).prop('checked', true);
			}
		}

    //options are transferred via get I think
		function getParam(key) {
			var params = window.location.hash;
			var val;
			params.replace(/(?:^|[#&])([a-z]+)=([^&]+)/ig, function(_, k, v) {
				if (key === k) {
					val = decodeURIComponent(v);
				}
			});
			return val;
		}

		function parseVersion(verStr) {
			var parts = verStr.split('.');
			return parts.reduce(function(sum, part) {
				return (sum * 1000) + parseInt(part, 10);
			}, 0);
		}

		$("#b-submit").click(function() {
			var location = "pebblejs://close#" + encodeURIComponent(JSON.stringify(saveOptions()));
			document.location = location;
		});

		var version = getParam('v');
		if (!version || (parseVersion(version) < parseVersion(LATEST))) {
			$('#update-available').removeClass('hidden');
		}
		else {
			$('#up-to-date').removeClass('hidden');
		}

		applyOptions();
   </script>

</body>
</html>
